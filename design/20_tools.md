# Tools 模块设计文档

## 概述

Tools模块是agent-go框架中的核心组件，提供了统一的工具调用接口和工具管理机制。该模块定义了工具的标准接口，实现了工具集合管理，并提供了多种内置工具实现。

## 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                        Tools Module                         │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │   Tool Interface│  │ ToolCollection  │  │   Decorators │ │
│  │                 │  │                 │  │              │ │
│  │ • Descriptor()  │  │ • AddTools()    │  │ • WithExtra  │ │
│  │ • Call()        │  │ • ContainsTool()│  │   Instruction│ │
│  └─────────────────┘  │ • Descriptors() │  └──────────────┘ │
│                       │ • Call()        │                   │
│                       └─────────────────┘                   │
├─────────────────────────────────────────────────────────────┤
│                    Built-in Tools                           │
│  ┌─────────────┐  ┌──────────────┐  ┌─────────────┐         │
│  │   Chores    │  │  Search Web  │  │   Utils     │         │
│  │             │  │              │  │             │         │
│  │ • Weather   │  │ • DuckDuckGo │  │ • Collection│         │
│  │ • Time      │  │              │  │   Management│         │
│  │ • Sleep     │  │              │  │             │         │
│  └─────────────┘  └──────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
```

## 核心数据结构

### Tool 接口

```go
type Tool interface {
    Descriptor() *llms.ToolDescriptor
    Call(ctx context.Context, params *llms.ToolCall) (*llms.ToolCallResult, error)
}
```

**核心方法：**
- `Descriptor()`: 返回工具的描述信息，包含名称、描述和参数定义
- `Call()`: 执行工具调用，接收上下文和参数，返回执行结果

### ToolCollection

```go
type ToolCollection struct {
    Tools []Tool
}
```

**核心方法：**
- `AddTools()`: 添加工具到集合
- `ContainsTool()`: 检查工具是否存在
- `Descriptors()`: 获取所有工具的描述信息
- `Call()`: 根据工具名称调用对应的工具
- `findTool()`: 内部方法，根据名称查找工具

### withExtraInstruction

```go
type withExtraInstruction struct {
    tool             Tool
    extraInstruction string
    replace          bool
}
```

**功能：** 装饰器模式实现，用于为工具添加额外的指令说明

## 内置工具实现

### Chores 工具集

#### WeatherTool
- **功能：** 获取指定城市的天气信息
- **参数：** city (必需), units (可选，默认metric)
- **返回：** 温度、天气状况、湿度、风速、气压等信息

#### CurrentTimeTool
- **功能：** 获取当前日期时间信息
- **参数：** timezone (可选), format (可选)
- **返回：** 格式化的时间、时区、Unix时间戳、ISO格式

#### SleepTool
- **功能：** 暂停执行指定时长
- **参数：** duration (必需，Go duration格式)
- **特性：** 支持上下文取消，可中断睡眠

### Web 检索工具

#### DuckDuckGoTool
- **功能：** 执行DuckDuckGo搜索
- **参数：** query (必需)
- **返回：** 搜索结果包含标题、URL、描述
- **特性：** 自动清理重定向URL，支持多种HTML结构解析

## 工具管理机制

### 工具注册与发现
- 通过`ToolCollection`统一管理多个工具
- 支持动态添加工具到集合
- 基于工具名称进行查找和调用

### 工具描述生成
- 每个工具通过`Descriptor()`方法提供标准化的描述信息
- 支持参数验证和类型检查
- 自动生成工具使用说明

### 错误处理
- 统一的错误返回格式
- 支持永久性错误和临时性错误区分
- 工具调用失败时返回结构化错误信息

## 扩展机制

### 装饰器模式
- `WithExtraInstruction()` 函数支持为工具添加额外说明
- 支持替换或追加描述信息
- 保持原有工具接口不变

### 自定义工具开发
- 实现`Tool`接口即可集成新工具
- 提供标准化的参数定义和结果格式
- 支持异步执行和上下文控制

## 设计要点

1. **接口统一**: 所有工具实现相同的接口规范
2. **类型安全**: 基于Schema的参数定义和运行时类型检查
3. **可扩展性**: 装饰器模式支持功能增强，工具集合支持动态管理
4. **上下文感知**: 支持上下文传递和取消，工具执行可被外部中断

## 总结

Tools 模块提供了统一的工具调用抽象，支持多种内置工具和自定义工具的集成。通过标准化的接口设计和装饰器模式，实现了对工具功能的统一管理和扩展。

该模块的核心价值在于为 Agent 提供了丰富的外部能力，包括信息查询、时间处理、网络搜索等实用功能。通过工具集合的管理机制，支持动态的工具注册和调用，为 Agent 的行为模式提供了强大的工具支持。

模块设计注重实用性和扩展性，提供了灵活的配置选项和错误处理机制，为上层应用提供了稳定可靠的工具调用服务基础。
